<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ü•ß Pi Recitation Verifier - 300 Digits</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            height: 100%;
            overflow-x: hidden;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 50%, #16213e 100%);
            min-height: 100vh;
            color: white;
            touch-action: manipulation;
        }

        .container {
            max-width: 650px;
            margin: 0 auto;
            padding: 8px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 10px;
        }

        .header h1 {
            font-size: clamp(1.3rem, 5vw, 1.8rem);
            font-weight: 800;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: clamp(0.7rem, 2vw, 0.85rem);
            color: #a5b4fc;
            margin-top: 3px;
        }

        /* Mode Toggle */
        .mode-toggle {
            display: flex;
            background: rgba(255,255,255,0.1);
            border-radius: 25px;
            padding: 3px;
            margin: 8px auto;
            max-width: 260px;
        }

        .mode-btn {
            flex: 1;
            padding: 10px 12px;
            border: none;
            background: transparent;
            color: #a5b4fc;
            font-size: 0.85rem;
            font-weight: 600;
            border-radius: 22px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mode-btn.active {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: #1a1a2e;
        }

        /* Stats Panel */
        .stats-panel {
            background: rgba(255,255,255,0.08);
            border-radius: 12px;
            padding: 10px;
            margin: 6px 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 6px;
        }

        .stat-box {
            text-align: center;
            padding: 6px 4px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
        }

        .stat-value {
            font-size: clamp(1rem, 3.5vw, 1.3rem);
            font-weight: 800;
            color: #fbbf24;
            font-family: 'Courier New', monospace;
        }

        .stat-value.time { color: #10b981; }
        .stat-value.speed { color: #8b5cf6; }
        .stat-value.remaining { color: #f59e0b; }

        .stat-label {
            font-size: 0.55rem;
            color: #a5b4fc;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 2px;
        }

        .live-stats-row {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .live-stat { text-align: center; }

        .live-stat-value {
            font-size: clamp(1.2rem, 4vw, 1.6rem);
            font-weight: 900;
            color: #10b981;
        }

        .live-stat-label {
            font-size: 0.65rem;
            color: #6b7280;
        }

        /* Progress Bar */
        .progress-container {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            margin: 8px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #fbbf24);
            border-radius: 3px;
            transition: width 0.1s linear;
            width: 0%;
        }

        /* Main Display - Digit Sequence */
        .main-display {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 10px 5px;
            min-height: 0;
        }

        .digit-sequence-area {
            text-align: center;
            width: 100%;
            padding: 15px 5px;
            background: rgba(0,0,0,0.3);
            border-radius: 20px;
            margin-bottom: 10px;
        }

        .pi-prefix-row {
            font-size: clamp(1.5rem, 5vw, 2rem);
            font-weight: 700;
            color: rgba(255,255,255,0.3);
            font-family: 'Courier New', monospace;
            margin-bottom: 10px;
        }

        /* Digit Sequence Display */
        .digit-sequence {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 2px;
            flex-wrap: nowrap;
            overflow: hidden;
        }

        .seq-digit {
            font-family: 'Courier New', monospace;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.15s ease;
        }

        /* Previous digits - blue/purple tint */
        .seq-digit.prev {
            font-size: clamp(1.5rem, 5vw, 2.5rem);
            color: #818cf8;
            padding: 5px 8px;
            background: rgba(129, 140, 248, 0.15);
            min-width: clamp(35px, 8vw, 50px);
        }

        .seq-digit.prev-far {
            font-size: clamp(1.2rem, 4vw, 2rem);
            color: #6366f1;
            opacity: 0.6;
            padding: 4px 6px;
            min-width: clamp(30px, 7vw, 45px);
        }

        /* Current digit - bright gold */
        .seq-digit.current {
            font-size: clamp(4rem, 15vw, 7rem);
            font-weight: 900;
            color: #1a1a2e;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            padding: 10px 20px;
            min-width: clamp(70px, 18vw, 120px);
            box-shadow: 0 0 30px rgba(251, 191, 36, 0.5), 0 0 60px rgba(251, 191, 36, 0.3);
            animation: currentPulse 0.2s ease;
            margin: 0 8px;
            border-radius: 12px;
        }

        @keyframes currentPulse {
            0% { transform: scale(0.95); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        /* Next digits - green tint */
        .seq-digit.next {
            font-size: clamp(1.5rem, 5vw, 2.5rem);
            color: #34d399;
            padding: 5px 8px;
            background: rgba(52, 211, 153, 0.15);
            min-width: clamp(35px, 8vw, 50px);
        }

        .seq-digit.next-far {
            font-size: clamp(1.2rem, 4vw, 2rem);
            color: #10b981;
            opacity: 0.6;
            padding: 4px 6px;
            min-width: clamp(30px, 7vw, 45px);
        }

        .seq-digit.placeholder {
            color: rgba(255,255,255,0.15);
            font-size: clamp(1.2rem, 4vw, 2rem);
            min-width: clamp(30px, 7vw, 45px);
        }

        /* Position Label */
        .position-label {
            font-size: clamp(0.9rem, 3vw, 1.1rem);
            color: #a5b4fc;
            margin-top: 12px;
            text-align: center;
        }

        /* Legend for colors */
        .color-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
            font-size: 0.7rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #6b7280;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        .legend-dot.prev { background: #818cf8; }
        .legend-dot.current { background: linear-gradient(135deg, #fbbf24, #f59e0b); }
        .legend-dot.next { background: #34d399; }

        /* Navigation Controls */
        .nav-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin: 10px 0;
        }

        .nav-btn {
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.15s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
        }

        .nav-btn.large {
            width: 55px;
            height: 55px;
            font-size: 1.5rem;
        }

        .nav-btn.small {
            width: 42px;
            height: 42px;
            font-size: 0.75rem;
        }

        .nav-btn.back { background: linear-gradient(135deg, #6366f1, #4f46e5); }
        .nav-btn.forward { background: linear-gradient(135deg, #10b981, #059669); }
        .nav-btn.back-10 { background: rgba(99, 102, 241, 0.5); }
        .nav-btn.forward-10 { background: rgba(16, 185, 129, 0.5); }

        .nav-btn:active { transform: scale(0.9); }
        .nav-btn:disabled { opacity: 0.3; cursor: not-allowed; transform: none; }

        /* Tap Zone */
        .tap-zone {
            display: none;
            width: 100%;
            padding: 25px 15px;
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.08), rgba(245, 158, 11, 0.03));
            border: 3px dashed rgba(251, 191, 36, 0.35);
            border-radius: 15px;
            text-align: center;
            margin: 10px 0;
            cursor: pointer;
            user-select: none;
            transition: all 0.1s ease;
        }

        .tap-zone.active { display: block; }

        .tap-zone.holding {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.25), rgba(251, 191, 36, 0.15));
            border-color: #10b981;
            transform: scale(0.98);
        }

        .tap-zone-text {
            font-size: clamp(1rem, 3.5vw, 1.2rem);
            color: #fbbf24;
            font-weight: 700;
        }

        .tap-zone-hint {
            font-size: 0.75rem;
            color: #a5b4fc;
            margin-top: 6px;
        }

        /* Auto Controls */
        .auto-controls {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            padding: 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            margin: 8px 0;
        }

        .auto-controls.active { display: flex; }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            max-width: 300px;
        }

        .speed-label {
            font-size: 0.8rem;
            font-weight: 600;
            min-width: 18px;
        }

        .speed-label.slow { color: #10b981; }
        .speed-label.fast { color: #ef4444; }

        .speed-slider {
            flex: 1;
            height: 10px;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(90deg, #10b981, #fbbf24, #ef4444);
            border-radius: 5px;
            outline: none;
        }

        .speed-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.4);
        }

        .speed-slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        .speed-value {
            font-size: 1rem;
            font-weight: 800;
            color: #fbbf24;
            min-width: 65px;
            text-align: center;
        }

        .auto-btn-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .control-btn {
            padding: 12px 22px;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .control-btn:active { transform: scale(0.95); }
        .control-btn.start { background: linear-gradient(135deg, #10b981, #059669); color: white; }
        .control-btn.pause { background: linear-gradient(135deg, #f59e0b, #d97706); color: white; }
        .control-btn.reset { background: linear-gradient(135deg, #ef4444, #dc2626); color: white; }
        .control-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        /* Digits Grid Toggle */
        .digits-section {
            margin: 8px 0;
        }

        .toggle-btn {
            width: 100%;
            background: rgba(255,255,255,0.06);
            border: none;
            color: #a5b4fc;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 0.8rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .digits-grid {
            display: none;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 10px;
            margin-top: 6px;
            max-height: 180px;
            overflow-y: auto;
        }

        .digits-grid.show { display: block; }

        .pi-prefix-grid {
            font-size: 0.95rem;
            font-weight: 700;
            color: #fbbf24;
            font-family: 'Courier New', monospace;
        }

        .pi-digits {
            font-family: 'Courier New', monospace;
            font-size: clamp(0.8rem, 2.5vw, 0.95rem);
            line-height: 2;
            letter-spacing: 1px;
        }

        .digit {
            display: inline-block;
            padding: 1px 3px;
            border-radius: 3px;
            color: rgba(255,255,255,0.3);
            transition: all 0.1s ease;
        }

        .digit.past {
            color: rgba(129, 140, 248, 0.7);
            background: rgba(129, 140, 248, 0.1);
        }

        .digit.current {
            color: #1a1a2e;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            font-weight: 800;
            transform: scale(1.1);
            box-shadow: 0 0 6px rgba(251, 191, 36, 0.5);
        }

        .group-sep {
            display: inline-block;
            width: 6px;
        }

        /* Verification Links */
        .verify-section {
            margin-top: 10px;
            padding: 12px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
        }

        .verify-title {
            font-size: 0.8rem;
            color: #a5b4fc;
            text-align: center;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .verify-links {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            justify-content: center;
        }

        .verify-link {
            background: rgba(99, 102, 241, 0.2);
            color: #a5b4fc;
            text-decoration: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.7rem;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .verify-link:hover {
            background: rgba(99, 102, 241, 0.4);
            color: white;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 10px;
            font-size: 0.65rem;
            color: #6b7280;
            margin-top: auto;
        }

        /* Responsive */
        @media (max-width: 380px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .seq-digit.current {
                font-size: clamp(3rem, 12vw, 5rem);
                padding: 8px 15px;
                min-width: clamp(55px, 15vw, 90px);
            }
            .seq-digit.prev, .seq-digit.next {
                font-size: clamp(1.2rem, 4vw, 1.8rem);
                min-width: clamp(28px, 7vw, 40px);
            }
        }

        @media (max-height: 600px) {
            .digit-sequence-area { padding: 10px 5px; }
            .seq-digit.current {
                font-size: clamp(3rem, 10vw, 4.5rem);
                padding: 8px 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>ü•ß Pi Recitation Verifier</h1>
            <p>300 digits after 3. ‚Ä¢ Tap or Auto mode</p>
        </header>

        <!-- Mode Toggle -->
        <div class="mode-toggle">
            <button class="mode-btn active" id="manualModeBtn" onclick="setMode('manual')">üëÜ Manual</button>
            <button class="mode-btn" id="autoModeBtn" onclick="setMode('auto')">‚è±Ô∏è Auto</button>
        </div>

        <!-- Stats Panel -->
        <div class="stats-panel">
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-value" id="digitCount">0</div>
                    <div class="stat-label">Digits</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value time" id="elapsedTime">0:00</div>
                    <div class="stat-label">Time</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value speed" id="liveSpeed">0.0</div>
                    <div class="stat-label">Digits/Sec</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value remaining" id="remaining">300</div>
                    <div class="stat-label">Left</div>
                </div>
            </div>
            <div class="live-stats-row">
                <div class="live-stat">
                    <div class="live-stat-value" id="avgSpeed">0.0</div>
                    <div class="live-stat-label">Avg Speed (d/s)</div>
                </div>
                <div class="live-stat">
                    <div class="live-stat-value" id="estTimeLeft">--:--</div>
                    <div class="live-stat-label">Est. Time Left</div>
                </div>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <!-- Main Display - Digit Sequence -->
        <div class="main-display">
            <div class="digit-sequence-area">
                <div class="pi-prefix-row">3.</div>
                
                <!-- Digit Sequence: Previous - Current - Next -->
                <div class="digit-sequence" id="digitSequence">
                    <span class="seq-digit placeholder">-</span>
                    <span class="seq-digit placeholder">-</span>
                    <span class="seq-digit current">-</span>
                    <span class="seq-digit next">1</span>
                    <span class="seq-digit next-far">4</span>
                </div>

                <div class="position-label" id="positionLabel">Ready to start</div>

                <!-- Color Legend -->
                <div class="color-legend">
                    <div class="legend-item">
                        <div class="legend-dot prev"></div>
                        <span>Previous</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot current"></div>
                        <span>Current</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot next"></div>
                        <span>Next</span>
                    </div>
                </div>
            </div>

            <!-- Navigation Controls -->
            <div class="nav-controls">
                <button class="nav-btn small back-10" onclick="navigate(-10)">-10</button>
                <button class="nav-btn large back" id="backBtn" onclick="navigate(-1)">‚óÄ</button>
                <button class="nav-btn large forward" id="forwardBtn" onclick="navigate(1)">‚ñ∂</button>
                <button class="nav-btn small forward-10" onclick="navigate(10)">+10</button>
            </div>

            <!-- Manual Mode: Tap Zone -->
            <div class="tap-zone active" id="tapZone">
                <div class="tap-zone-text" id="tapText">üëÜ TAP to advance</div>
                <div class="tap-zone-hint">Hold for continuous ‚Ä¢ Use ‚óÄ‚ñ∂ for back/forward</div>
            </div>

            <!-- Auto Mode: Speed Controls -->
            <div class="auto-controls" id="autoControls">
                <div class="speed-control">
                    <span class="speed-label slow">3</span>
                    <input type="range" class="speed-slider" id="speedSlider" min="3" max="6" step="0.5" value="3">
                    <span class="speed-label fast">6</span>
                    <div class="speed-value" id="speedValue">3.0/s</div>
                </div>
                <div class="auto-btn-row">
                    <button class="control-btn start" id="startBtn" onclick="startAuto()">‚ñ∂Ô∏è Start</button>
                    <button class="control-btn pause" id="pauseBtn" onclick="pauseAuto()" disabled>‚è∏Ô∏è Pause</button>
                    <button class="control-btn reset" id="resetBtn" onclick="resetAll()">üîÑ Reset</button>
                </div>
            </div>
        </div>

        <!-- Collapsible Digits Grid -->
        <div class="digits-section">
            <button class="toggle-btn" onclick="toggleDigitsGrid()">
                <span>üìã View All 300 Digits</span>
                <span id="toggleArrow">‚ñº</span>
            </button>
            <div class="digits-grid" id="digitsGrid">
                <span class="pi-prefix-grid">3.</span>
                <span class="pi-digits" id="piDigitsContainer"></span>
            </div>
        </div>

        <!-- Official Verification Links -->
        <div class="verify-section">
            <div class="verify-title">üîç Verify Pi Digits - Official Sources</div>
            <div class="verify-links">
                <a href="https://www.piday.org/million/" target="_blank" class="verify-link">ü•ß PiDay.org (1M digits)</a>
                <a href="https://www.angio.net/pi/digits.html" target="_blank" class="verify-link">üî¢ Angio.net</a>
                <a href="https://www.math.com/tables/constants/pi.htm" target="_blank" class="verify-link">üìê Math.com</a>
                <a href="https://oeis.org/A000796" target="_blank" class="verify-link">üßÆ OEIS A000796</a>
                <a href="https://www.wolframalpha.com/input?i=first+300+digits+of+pi" target="_blank" class="verify-link">üê∫ Wolfram Alpha</a>
                <a href="https://stuff.mit.edu/afs/sipb/contrib/pi/" target="_blank" class="verify-link">üéì MIT (1B digits)</a>
            </div>
        </div>

        <!-- Professional Pi Community Links -->
        <div class="verify-section">
            <div class="verify-title">üèÜ Professional Pi Recitation Community</div>
            <div class="verify-links">
                <a href="https://www.pi-world-ranking-list.com/?page=lists&category=pi" target="_blank" class="verify-link">üåç Pi World Ranking List</a>
                <a href="https://www.worldpifederation.org/" target="_blank" class="verify-link">üèÖ World Pi Federation</a>
                <a href="https://memory-pi.andreharnist.fr/" target="_blank" class="verify-link">üéÆ Memory Pi Game</a>
                <a href="https://www.piday.org/pi-quiz/" target="_blank" class="verify-link">üìù Pi Quiz (150 digits)</a>
                <a href="https://forum.artofmemory.com/" target="_blank" class="verify-link">üí¨ Art of Memory Forum</a>
                <a href="https://www.teachpi.org/activities/contests/" target="_blank" class="verify-link">üéØ TeachPi Contests</a>
            </div>
        </div>

        <!-- NASA & Scientific Links -->
        <div class="verify-section">
            <div class="verify-title">üöÄ NASA & Scientific Resources</div>
            <div class="verify-links">
                <a href="https://www.jpl.nasa.gov/edu/resources/teachable-moment/pi-goes-the-distance-at-nasa/" target="_blank" class="verify-link">üõ∏ NASA JPL Pi Day</a>
                <a href="https://pi2e.ch/blog/2017/03/10/pi-digits-download/" target="_blank" class="verify-link">üì• Pi2e.ch Downloads</a>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>üß† Created for memory athletes by <strong>Dineshkumar Rajendran</strong></p>
        </footer>
    </div>

    <script>
        // First 300 digits of Pi after the decimal point
        const PI_DIGITS = "141592653589793238462643383279502884197169399375105820974944592307816406286208998628034825342117067982148086513282306647093844609550582231725359408128481117450284102701938521105559644622948954930381964428810975665933446128475648233786783165271201909145648566923460348610454326648213393607260249141273724587006606315588174881520920962829254091715364367892590360011330530548820466521384146951941511609";

        // State
        let currentIndex = -1;
        let mode = 'manual';
        let isRunning = false;
        let isPaused = false;
        let autoInterval = null;
        let speed = 3;

        // Timing
        let startTime = null;
        let totalElapsed = 0;
        let pauseStart = null;
        let timerInterval = null;
        let holdInterval = null;
        let isHolding = false;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initDigitsGrid();
            updateDisplay();
            setupTapZone();
            setupSpeedSlider();
            startTimer();
        });

        // Initialize digits grid
        function initDigitsGrid() {
            const container = document.getElementById('piDigitsContainer');
            let html = '';
            for (let i = 0; i < PI_DIGITS.length; i++) {
                html += `<span class="digit" id="digit-${i}">${PI_DIGITS[i]}</span>`;
                if ((i + 1) % 5 === 0 && i < PI_DIGITS.length - 1) {
                    html += '<span class="group-sep"></span>';
                }
                if ((i + 1) % 50 === 0) {
                    html += '<br>';
                }
            }
            container.innerHTML = html;
        }

        // Update digit sequence display
        function updateDigitSequence() {
            const container = document.getElementById('digitSequence');
            let html = '';
            
            // Show 2 previous digits
            for (let i = currentIndex - 2; i < currentIndex; i++) {
                if (i < 0) {
                    html += `<span class="seq-digit placeholder">-</span>`;
                } else {
                    const farClass = i === currentIndex - 2 ? 'prev-far' : 'prev';
                    html += `<span class="seq-digit ${farClass}">${PI_DIGITS[i]}</span>`;
                }
            }
            
            // Current digit
            if (currentIndex < 0) {
                html += `<span class="seq-digit current">-</span>`;
            } else if (currentIndex >= PI_DIGITS.length) {
                html += `<span class="seq-digit current">‚úì</span>`;
            } else {
                html += `<span class="seq-digit current">${PI_DIGITS[currentIndex]}</span>`;
            }
            
            // Show 2 next digits
            for (let i = currentIndex + 1; i <= currentIndex + 2; i++) {
                if (i >= PI_DIGITS.length) {
                    html += `<span class="seq-digit placeholder">-</span>`;
                } else if (currentIndex < 0) {
                    // Before start, show first digits as next
                    const idx = i;
                    const farClass = i === currentIndex + 2 ? 'next-far' : 'next';
                    html += `<span class="seq-digit ${farClass}">${PI_DIGITS[idx]}</span>`;
                } else {
                    const farClass = i === currentIndex + 2 ? 'next-far' : 'next';
                    html += `<span class="seq-digit ${farClass}">${PI_DIGITS[i]}</span>`;
                }
            }
            
            container.innerHTML = html;
        }

        // Setup tap zone
        function setupTapZone() {
            const tapZone = document.getElementById('tapZone');
            
            tapZone.addEventListener('touchstart', handleTapStart, { passive: false });
            tapZone.addEventListener('touchend', handleTapEnd);
            tapZone.addEventListener('touchcancel', handleTapEnd);
            
            tapZone.addEventListener('mousedown', handleTapStart);
            tapZone.addEventListener('mouseup', handleTapEnd);
            tapZone.addEventListener('mouseleave', handleTapEnd);
        }

        function handleTapStart(e) {
            e.preventDefault();
            if (mode !== 'manual') return;
            
            if (startTime === null && currentIndex === -1) {
                startTime = Date.now();
            }
            
            const tapZone = document.getElementById('tapZone');
            tapZone.classList.add('holding');
            document.getElementById('tapText').textContent = '‚è© Advancing...';
            
            navigate(1);
            
            isHolding = true;
            holdInterval = setInterval(() => {
                if (isHolding && currentIndex < PI_DIGITS.length - 1) {
                    navigate(1);
                }
            }, 180);
        }

        function handleTapEnd() {
            if (mode !== 'manual') return;
            
            const tapZone = document.getElementById('tapZone');
            tapZone.classList.remove('holding');
            document.getElementById('tapText').textContent = 'üëÜ TAP to advance';
            
            isHolding = false;
            if (holdInterval) {
                clearInterval(holdInterval);
                holdInterval = null;
            }
        }

        // Setup speed slider
        function setupSpeedSlider() {
            const slider = document.getElementById('speedSlider');
            slider.addEventListener('input', function() {
                speed = parseFloat(this.value);
                document.getElementById('speedValue').textContent = speed.toFixed(1) + '/s';
                
                if (isRunning && !isPaused) {
                    clearInterval(autoInterval);
                    autoInterval = setInterval(autoAdvance, 1000 / speed);
                }
                
                updateEstimatedTime();
            });
        }

        // Timer
        function startTimer() {
            timerInterval = setInterval(updateTimer, 100);
        }

        function updateTimer() {
            if (startTime === null) return;
            
            let elapsed;
            if (isPaused && pauseStart) {
                elapsed = (pauseStart - startTime) / 1000;
            } else {
                elapsed = (Date.now() - startTime) / 1000;
            }
            
            totalElapsed = elapsed;
            
            const mins = Math.floor(elapsed / 60);
            const secs = Math.floor(elapsed % 60);
            document.getElementById('elapsedTime').textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
            
            if (currentIndex >= 0 && elapsed > 0) {
                const liveSpeed = (currentIndex + 1) / elapsed;
                document.getElementById('liveSpeed').textContent = liveSpeed.toFixed(1);
                document.getElementById('avgSpeed').textContent = liveSpeed.toFixed(2);
            }
            
            updateEstimatedTime();
        }

        function updateEstimatedTime() {
            const remaining = PI_DIGITS.length - (currentIndex + 1);
            document.getElementById('remaining').textContent = remaining;
            
            let estSeconds;
            if (mode === 'auto') {
                estSeconds = remaining / speed;
            } else {
                if (totalElapsed > 0 && currentIndex >= 0) {
                    const avgSpeed = (currentIndex + 1) / totalElapsed;
                    estSeconds = avgSpeed > 0 ? remaining / avgSpeed : 0;
                } else {
                    estSeconds = 0;
                }
            }
            
            if (estSeconds > 0 && remaining > 0) {
                const mins = Math.floor(estSeconds / 60);
                const secs = Math.floor(estSeconds % 60);
                document.getElementById('estTimeLeft').textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
            } else if (remaining === 0) {
                document.getElementById('estTimeLeft').textContent = 'Done!';
            } else {
                document.getElementById('estTimeLeft').textContent = '--:--';
            }
        }

        // Mode switching
        function setMode(newMode) {
            mode = newMode;
            
            document.getElementById('manualModeBtn').classList.toggle('active', mode === 'manual');
            document.getElementById('autoModeBtn').classList.toggle('active', mode === 'auto');
            
            document.getElementById('tapZone').classList.toggle('active', mode === 'manual');
            document.getElementById('autoControls').classList.toggle('active', mode === 'auto');
            
            if (mode === 'manual' && isRunning) {
                pauseAuto();
            }
        }

        // Navigation
        function navigate(delta) {
            const newIndex = currentIndex + delta;
            
            if (newIndex < -1 || newIndex >= PI_DIGITS.length) return;
            
            if (startTime === null && delta > 0) {
                startTime = Date.now();
            }
            
            // Update grid display
            if (currentIndex >= 0) {
                const prevDigit = document.getElementById(`digit-${currentIndex}`);
                if (prevDigit) {
                    prevDigit.classList.remove('current');
                    if (newIndex > currentIndex) {
                        prevDigit.classList.add('past');
                    }
                }
            }
            
            currentIndex = newIndex;
            
            // Handle going backwards
            if (delta < 0) {
                for (let i = currentIndex + 1; i < PI_DIGITS.length; i++) {
                    const digit = document.getElementById(`digit-${i}`);
                    if (digit) {
                        digit.classList.remove('past', 'current');
                    }
                }
            }
            
            // Update grid current
            if (currentIndex >= 0) {
                const currDigit = document.getElementById(`digit-${currentIndex}`);
                if (currDigit) {
                    currDigit.classList.remove('past');
                    currDigit.classList.add('current');
                    
                    if (document.getElementById('digitsGrid').classList.contains('show')) {
                        currDigit.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }
            }
            
            updateDisplay();
            
            if (currentIndex >= PI_DIGITS.length - 1) {
                completeRecitation();
            }
        }

        // Update all displays
        function updateDisplay() {
            updateDigitSequence();
            
            // Position label
            const posLabel = document.getElementById('positionLabel');
            if (currentIndex >= 0) {
                posLabel.textContent = `Digit ${currentIndex + 1} of 300`;
            } else {
                posLabel.textContent = 'Ready to start';
            }
            
            document.getElementById('digitCount').textContent = Math.max(0, currentIndex + 1);
            
            const progress = ((currentIndex + 1) / PI_DIGITS.length) * 100;
            document.getElementById('progressBar').style.width = Math.max(0, progress) + '%';
            
            document.getElementById('backBtn').disabled = currentIndex < 0;
            document.getElementById('forwardBtn').disabled = currentIndex >= PI_DIGITS.length - 1;
            
            updateEstimatedTime();
        }

        // Auto mode
        function startAuto() {
            if (isRunning && !isPaused) return;
            
            if (startTime === null) {
                startTime = Date.now();
            } else if (isPaused) {
                startTime += Date.now() - pauseStart;
            }
            
            isRunning = true;
            isPaused = false;
            pauseStart = null;
            
            autoInterval = setInterval(autoAdvance, 1000 / speed);
            
            document.getElementById('startBtn').disabled = true;
            document.getElementById('pauseBtn').disabled = false;
        }

        function pauseAuto() {
            if (!isRunning || isPaused) return;
            
            isPaused = true;
            pauseStart = Date.now();
            
            clearInterval(autoInterval);
            autoInterval = null;
            
            document.getElementById('startBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = true;
        }

        function autoAdvance() {
            if (currentIndex < PI_DIGITS.length - 1) {
                navigate(1);
            } else {
                completeRecitation();
            }
        }

        // Reset
        function resetAll() {
            clearInterval(autoInterval);
            autoInterval = null;
            isRunning = false;
            isPaused = false;
            
            startTime = null;
            totalElapsed = 0;
            pauseStart = null;
            
            currentIndex = -1;
            
            document.querySelectorAll('.digit').forEach(d => {
                d.classList.remove('current', 'past');
            });
            
            document.getElementById('elapsedTime').textContent = '0:00';
            document.getElementById('liveSpeed').textContent = '0.0';
            document.getElementById('avgSpeed').textContent = '0.0';
            document.getElementById('estTimeLeft').textContent = '--:--';
            
            document.getElementById('startBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = true;
            
            updateDisplay();
        }

        // Complete
        function completeRecitation() {
            clearInterval(autoInterval);
            autoInterval = null;
            isRunning = false;
            
            document.getElementById('positionLabel').textContent = `üéâ Completed 300 digits in ${document.getElementById('elapsedTime').textContent}!`;
            document.getElementById('estTimeLeft').textContent = 'Done!';
            
            document.getElementById('startBtn').disabled = true;
            document.getElementById('pauseBtn').disabled = true;
        }

        // Toggle digits grid
        function toggleDigitsGrid() {
            const grid = document.getElementById('digitsGrid');
            const arrow = document.getElementById('toggleArrow');
            
            grid.classList.toggle('show');
            arrow.textContent = grid.classList.contains('show') ? '‚ñ≤' : '‚ñº';
            
            if (grid.classList.contains('show') && currentIndex >= 0) {
                const currDigit = document.getElementById(`digit-${currentIndex}`);
                if (currDigit) {
                    setTimeout(() => {
                        currDigit.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 100);
                }
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            switch(e.code) {
                case 'Space':
                    e.preventDefault();
                    if (mode === 'manual') {
                        navigate(1);
                        if (startTime === null) startTime = Date.now();
                    } else {
                        if (!isRunning || isPaused) startAuto();
                        else pauseAuto();
                    }
                    break;
                case 'ArrowRight':
                    e.preventDefault();
                    navigate(1);
                    break;
                case 'ArrowLeft':
                    e.preventDefault();
                    navigate(-1);
                    break;
                case 'ArrowUp':
                    e.preventDefault();
                    navigate(10);
                    break;
                case 'ArrowDown':
                    e.preventDefault();
                    navigate(-10);
                    break;
                case 'KeyR':
                    resetAll();
                    break;
                case 'KeyM':
                    setMode(mode === 'manual' ? 'auto' : 'manual');
                    break;
            }
        });
    </script>
</body>
</html>
